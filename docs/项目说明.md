# ã€Šæ–°é—»è”æ’­ã€‹æ–‡å­—ç¨¿çˆ¬è™«é¡¹ç›® - å¯åŠ¨è¯´æ˜Ž

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨çˆ¬å–å¤®è§†ã€Šæ–°é—»è”æ’­ã€‹æ–‡å­—ç¨¿çš„ Node.js é¡¹ç›®ã€‚æ¯å¤©è‡ªåŠ¨æŠ“å–å½“æ—¥æ–°é—»è”æ’­å†…å®¹å¹¶ç”Ÿæˆ Markdown æ ¼å¼çš„æ–‡å­—ç¨¿,åŒæ—¶æä¾› Web é¡µé¢æŸ¥çœ‹åŽ†å²è®°å½•ã€‚

**æ ¸å¿ƒåŠŸèƒ½:**
- è‡ªåŠ¨çˆ¬å– CCTV æ–°é—»è”æ’­å®˜ç½‘å†…å®¹
- ç”Ÿæˆ Markdown æ ¼å¼çš„æ–‡å­—ç¨¿
- ç»´æŠ¤åŽ†å²ç›®å½•ç´¢å¼•
- æä¾› Web ç•Œé¢æŸ¥çœ‹

---

## å¿«é€Ÿå¯åŠ¨

### 1. çŽ¯å¢ƒè¦æ±‚
- Node.js (æ”¯æŒ ES Module,å»ºè®® v14+)
- npm æˆ– yarn

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. è¿è¡Œçˆ¬è™«
```bash
npm run index
# æˆ–ç›´æŽ¥è¿è¡Œ
node index.js
```

### 4. æŸ¥çœ‹ç»“æžœ
- ç”Ÿæˆçš„æ–‡å­—ç¨¿ä½äºŽ `/news/YYYYMMDD.md`
- æ‰“å¼€ `index.html` æŸ¥çœ‹æ‰€æœ‰åŽ†å²è®°å½•
- æ‰“å¼€ `web/view.html?date=YYYYMMDD` æŸ¥çœ‹æŒ‡å®šæ—¥æœŸ

---

## é¡¹ç›®ç»“æž„ä¸Žæ–‡ä»¶è¯´æ˜Ž

### ðŸ“ æ ¹ç›®å½•æ–‡ä»¶

#### **`package.json`**
**ä½œç”¨:** é¡¹ç›®é…ç½®æ–‡ä»¶
- å®šä¹‰é¡¹ç›®åç§°ä¸º "xin-wen-lian-bo" (æ–°é—»è”æ’­)
- å£°æ˜Žä¾èµ–: `jsdom` (DOM è§£æž) å’Œ `node-fetch` (HTTP è¯·æ±‚)
- é…ç½® `type: "module"` å¯ç”¨ ES Module
- å®šä¹‰å¯åŠ¨è„šæœ¬ `npm run index`

#### **`index.js`** â­ æ ¸å¿ƒä¸»ç¨‹åº
**ä½œç”¨:** çˆ¬è™«ä¸»é€»è¾‘,è´Ÿè´£æ•´ä¸ªæ•°æ®æŠ“å–å’Œå¤„ç†æµç¨‹

**æ ¸å¿ƒæµç¨‹:**
1. **èŽ·å–æ–°é—»åˆ—è¡¨** (`getNewsList`) - ä»Ž CCTV å®˜ç½‘æŠ“å–å½“æ—¥æ–°é—»é“¾æŽ¥
2. **èŽ·å–æ–°é—»æ‘˜è¦** (`getAbstract`) - æå–æ–°é—»ç®€ä»‹
3. **èŽ·å–è¯¦ç»†æ–°é—»** (`getNews`) - é€æ¡æŠ“å–æ–°é—»æ ‡é¢˜å’Œå†…å®¹
4. **è½¬æ¢ä¸º Markdown** (`newsToMarkdown`) - æ ¼å¼åŒ–ä¸º MD æ–‡æ¡£
5. **ä¿å­˜æ–‡ä»¶** (`saveTextToFile`) - å†™å…¥ `/news/YYYYMMDD.md`
6. **æ›´æ–°ç›®å½•** (`updateCatalogue`) - æ›´æ–° `catalogue.json` å’Œ `README.md`

**å…³é”®å‡½æ•°:**
- `getDate()` - èŽ·å–å½“å‰æ—¥æœŸ (æ ¼å¼: 20220929)
- `readFile()` / `writeFile()` - æ–‡ä»¶è¯»å†™å°è£…
- `getNewsList()` - è§£æž CCTV æ–°é—»åˆ—è¡¨é¡µ
- `getAbstract()` - æå–æ–°é—»æ‘˜è¦
- `getNews()` - æ‰¹é‡æŠ“å–æ–°é—»è¯¦æƒ…
- `newsToMarkdown()` - ç”Ÿæˆ Markdown æ–‡æ¡£
- `updateCatalogue()` - ç»´æŠ¤ç´¢å¼•æ–‡ä»¶

#### **`fetch.js`**
**ä½œç”¨:** HTTP è¯·æ±‚å°è£…æ¨¡å—
- å°è£… `node-fetch` åº“
- é…ç½®è¯·æ±‚å¤´æ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸º (User-Agent, Referer ç­‰)
- é¿å…è¢«åçˆ¬è™«æœºåˆ¶æ‹¦æˆª
- è¿”å›ž HTML æ–‡æœ¬å†…å®¹

#### **`index.html`** ðŸŒ ä¸»é¡µé¢
**ä½œç”¨:** é¡¹ç›®é¦–é¡µ,å±•ç¤ºæ‰€æœ‰æ–°é—»ç›®å½•å’Œæ‘˜è¦
- è¯»å– `/news/catalogue.json` èŽ·å–åŽ†å²è®°å½•
- ä½¿ç”¨ `showdown.js` å°† Markdown æ¸²æŸ“ä¸º HTML
- æ˜¾ç¤ºç›®å½•åˆ—è¡¨å’Œæ–°é—»æ‘˜è¦
- æä¾›è·³è½¬åˆ°è¯¦æƒ…é¡µçš„é“¾æŽ¥

#### **`.gitignore`**
**ä½œç”¨:** Git ç‰ˆæœ¬æŽ§åˆ¶å¿½ç•¥æ–‡ä»¶
- å¿½ç•¥ `node_modules` (ä¾èµ–åŒ…)
- å¿½ç•¥ `serve.json` (æœ¬åœ°é…ç½®)

#### **`DEVELOP.md`**
**ä½œç”¨:** å¼€å‘æ–‡æ¡£ (å½“å‰ä¸ºç©º,æ ‡è®°ä¸º"å¾…å®Œå–„")

#### **`LICENSE`**
**ä½œç”¨:** å¼€æºåè®®æ–‡ä»¶

---

### ðŸ“ `/news` ç›®å½•

**ä½œç”¨:** å­˜å‚¨æ‰€æœ‰æ–°é—»æ–‡å­—ç¨¿

#### **`/news/YYYYMMDD.md`**
- æ¯æ—¥ç”Ÿæˆçš„æ–°é—»è”æ’­æ–‡å­—ç¨¿
- åŒ…å«æ–°é—»æ‘˜è¦å’Œè¯¦ç»†å†…å®¹
- Markdown æ ¼å¼,ä¾¿äºŽé˜…è¯»å’Œç‰ˆæœ¬ç®¡ç†

#### **`/news/catalogue.json`**
**ä½œç”¨:** åŽ†å²è®°å½•ç´¢å¼•æ–‡ä»¶
- JSON æ•°ç»„æ ¼å¼
- æ¯æ¡è®°å½•åŒ…å« `date` (æ—¥æœŸ) å’Œ `abstract` (æ‘˜è¦)
- ç”¨äºŽé¦–é¡µå¿«é€ŸåŠ è½½ç›®å½•

**æ•°æ®ç»“æž„:**
```json
[
  {
    "date": "20220929",
    "abstract": "æ–°é—»æ‘˜è¦å†…å®¹..."
  }
]
```

---

### ðŸ“ `/web` ç›®å½•

**ä½œç”¨:** Web å‰ç«¯èµ„æº

#### **`view.html`** ðŸŒ è¯¦æƒ…é¡µ
**ä½œç”¨:** æŸ¥çœ‹æŒ‡å®šæ—¥æœŸçš„æ–°é—»æ–‡å­—ç¨¿
- é€šè¿‡ URL å‚æ•° `?date=YYYYMMDD` æŒ‡å®šæ—¥æœŸ
- åŠ¨æ€åŠ è½½ `/news/YYYYMMDD.md` æ–‡ä»¶
- ä½¿ç”¨ `showdown.js` æ¸²æŸ“ Markdown
- åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤º `Error.md`

#### **`Error.md`**
**ä½œç”¨:** 404 é”™è¯¯æç¤ºé¡µé¢
- å½“è®¿é—®ä¸å­˜åœ¨çš„æ—¥æœŸæ—¶æ˜¾ç¤º
- è¯´æ˜Žå¯èƒ½çš„é”™è¯¯åŽŸå› 

#### **`github-markdown.min.css`**
**ä½œç”¨:** GitHub é£Žæ ¼çš„ Markdown æ ·å¼è¡¨
- æä¾›ç¾Žè§‚çš„æ–‡æ¡£æ¸²æŸ“æ•ˆæžœ

#### **`showdown.min.js`**
**ä½œç”¨:** Markdown è½¬ HTML çš„ JavaScript åº“
- å‰ç«¯å®žæ—¶æ¸²æŸ“ Markdown å†…å®¹

---

## å·¥ä½œæµç¨‹å›¾

```
ç”¨æˆ·è¿è¡Œ node index.js
    â†“
èŽ·å–å½“å‰æ—¥æœŸ (å¦‚: 20220929)
    â†“
è®¿é—® CCTV å®˜ç½‘èŽ·å–æ–°é—»åˆ—è¡¨
    â†“
æå–æ‘˜è¦é“¾æŽ¥å’Œæ–°é—»é“¾æŽ¥æ•°ç»„
    â†“
æŠ“å–æ–°é—»æ‘˜è¦å†…å®¹
    â†“
é€æ¡æŠ“å–æ‰€æœ‰æ–°é—»è¯¦æƒ… (æ ‡é¢˜+å†…å®¹)
    â†“
è½¬æ¢ä¸º Markdown æ ¼å¼
    â†“
ä¿å­˜åˆ° /news/20220929.md
    â†“
æ›´æ–° /news/catalogue.json (è¿½åŠ æ–°è®°å½•)
    â†“
æ›´æ–° README.md (æ’å…¥æ–°é“¾æŽ¥)
    â†“
å®Œæˆ âœ“
```

---

## æ•°æ®æ¥æº

**ç›®æ ‡ç½‘ç«™:** CCTV æ–°é—»è”æ’­å®˜ç½‘
- åˆ—è¡¨é¡µ: `http://tv.cctv.com/lm/xwlb/day/YYYYMMDD.shtml`
- è¯¦æƒ…é¡µ: ä»Žåˆ—è¡¨é¡µè§£æžçš„å„æ–°é—»é“¾æŽ¥

**çˆ¬å–ç­–ç•¥:**
- ä½¿ç”¨ `jsdom` è§£æž HTML DOM
- é€šè¿‡ CSS é€‰æ‹©å™¨å®šä½å…ƒç´ 
- æ¨¡æ‹Ÿæµè§ˆå™¨è¯·æ±‚å¤´é¿å…æ‹¦æˆª

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ è¿è¡Œæ—¶æœº
- å»ºè®®æ¯å¤© **20:30 ä¹‹åŽ** è¿è¡Œ,ç¡®ä¿æ–°é—»è”æ’­å·²æ’­å‡ºä¸”å®˜ç½‘å·²æ›´æ–°
- è¿‡æ—©è¿è¡Œä¼šå¯¼è‡´æŠ“å–å¤±è´¥

### âš ï¸ ç½‘ç»œä¾èµ–
- éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿žæŽ¥è®¿é—® CCTV å®˜ç½‘
- è¯·æ±‚å¤±è´¥æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸

### âš ï¸ åçˆ¬è™«
- å·²é…ç½®è¯·æ±‚å¤´æ¨¡æ‹Ÿæµè§ˆå™¨
- å¦‚é‡æ‹¦æˆª,å¯èƒ½éœ€è¦æ›´æ–° `fetch.js` ä¸­çš„ headers

### âš ï¸ é€‰æ‹©å™¨å¤±æ•ˆ
- å¦‚æžœ CCTV å®˜ç½‘æ”¹ç‰ˆ,CSS é€‰æ‹©å™¨å¯èƒ½å¤±æ•ˆ
- éœ€è¦æ›´æ–° `index.js` ä¸­çš„é€‰æ‹©å™¨è·¯å¾„

---

## è‡ªåŠ¨åŒ–éƒ¨ç½²å»ºè®®

### ä½¿ç”¨ Cron å®šæ—¶ä»»åŠ¡ (Linux/Mac)
```bash
# æ¯å¤© 20:30 è‡ªåŠ¨è¿è¡Œ
30 20 * * * cd /path/to/project && node index.js
```

### ä½¿ç”¨ GitHub Actions
```yaml
name: Daily News Fetch
on:
  schedule:
    - cron: '30 12 * * *'  # UTC 12:30 = åŒ—äº¬æ—¶é—´ 20:30
jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: node index.js
      - run: git add . && git commit -m "Update news" && git push
```

---

## æŠ€æœ¯æ ˆ

- **è¿è¡ŒçŽ¯å¢ƒ:** Node.js (ES Module)
- **HTTP è¯·æ±‚:** node-fetch
- **HTML è§£æž:** jsdom
- **å‰ç«¯æ¸²æŸ“:** showdown.js (Markdown â†’ HTML)
- **æ ·å¼:** github-markdown.css

---

## å¼€å‘å»ºè®®

### ä»£ç è´¨é‡è¯„ä¼° ðŸŸ¡ å¯æŽ¥å—

**ä¼˜ç‚¹:**
- é€»è¾‘æ¸…æ™°,æµç¨‹ç®€å•ç›´æŽ¥
- å‡½æ•°èŒè´£å•ä¸€
- ä½¿ç”¨ Promise å¤„ç†å¼‚æ­¥

**æ”¹è¿›ç©ºé—´:**
1. **ç¡¬ç¼–ç çš„ CSS é€‰æ‹©å™¨** - åº”æå–ä¸ºé…ç½®æ–‡ä»¶
2. **é”™è¯¯å¤„ç†ä¸è¶³** - ç¼ºå°‘ try-catch å’Œé‡è¯•æœºåˆ¶
3. **å¹¶å‘æŠ“å–** - å¯ä½¿ç”¨ `Promise.all` æå‡é€Ÿåº¦
4. **æ—¥å¿—ç³»ç»Ÿ** - åº”ä½¿ç”¨ä¸“ä¸šæ—¥å¿—åº“ (å¦‚ winston)
5. **é…ç½®ç®¡ç†** - åº”åˆ†ç¦»é…ç½®å’Œä»£ç 

### å»ºè®®é‡æž„æ–¹å‘

```javascript
// é…ç½®æ–‡ä»¶ config.js
export default {
  selectors: {
    abstract: '#page_body > div.allcontent > ...',
    title: '#page_body > div.allcontent > ...',
    content: '#content_area'
  },
  retry: 3,
  timeout: 5000
}

// é”™è¯¯å¤„ç†
const getNewsWithRetry = async (url, retries = 3) => {
  for (let i = 0; i < retries; i++) {
    try {
      return await getNews(url);
    } catch (e) {
      if (i === retries - 1) throw e;
      await sleep(1000 * (i + 1));
    }
  }
}
```

---

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæŠ“å–å¤±è´¥?**
A: æ£€æŸ¥ç½‘ç»œè¿žæŽ¥ã€è¿è¡Œæ—¶é—´ (æ˜¯å¦è¿‡æ—©)ã€CCTV å®˜ç½‘æ˜¯å¦æ”¹ç‰ˆ

**Q: å¦‚ä½•æŸ¥çœ‹åŽ†å²è®°å½•?**
A: æ‰“å¼€ `index.html` æˆ–è®¿é—® `web/view.html?date=YYYYMMDD`

**Q: å¯ä»¥æŠ“å–åŽ†å²æ•°æ®å—?**
A: å¯ä»¥ä¿®æ”¹ `DATE` å˜é‡ä¸ºæŒ‡å®šæ—¥æœŸ,ä½†éœ€æ³¨æ„ CCTV å®˜ç½‘çš„åŽ†å²æ•°æ®å¯ç”¨æ€§

**Q: å¦‚ä½•éƒ¨ç½²åˆ°æœåŠ¡å™¨?**
A: é…ç½® Cron å®šæ—¶ä»»åŠ¡æˆ–ä½¿ç”¨ GitHub Actions è‡ªåŠ¨åŒ–

---

## æ€»ç»“

è¿™æ˜¯ä¸€ä¸ª **ç®€å•å®žç”¨** çš„æ–°é—»çˆ¬è™«é¡¹ç›®,æ ¸å¿ƒä»£ç ä¸åˆ° 200 è¡Œ,ä½†åŠŸèƒ½å®Œæ•´ã€‚

**é€‚åˆåœºæ™¯:**
- ä¸ªäººå­¦ä¹ çˆ¬è™«æŠ€æœ¯
- è‡ªåŠ¨åŒ–æ–°é—»å½’æ¡£
- æ•°æ®åˆ†æžç ”ç©¶

**æ ¸å¿ƒä»·å€¼:**
- ä»£ç ç®€æ´,æ˜“äºŽç†è§£å’Œä¿®æ”¹
- æ— æ•°æ®åº“ä¾èµ–,çº¯æ–‡ä»¶å­˜å‚¨
- å‰ç«¯å±•ç¤ºå‹å¥½

**æ”¹è¿›å»ºè®®:**
- å¢žå¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—
- æå–é…ç½®,é™ä½Žç»´æŠ¤æˆæœ¬
- ä¼˜åŒ–å¹¶å‘æ€§èƒ½
- æ·»åŠ å•å…ƒæµ‹è¯•

---

&copy; 2024 é¡¹ç›®è¯´æ˜Žæ–‡æ¡£ | åŸºäºŽæºä»£ç åˆ†æžç”Ÿæˆ
